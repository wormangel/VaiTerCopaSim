$(document).ready(function(){function e(){$("#modal_add_stickers").modal(),$("#textarea_sticker_numbers").focus()}function t(){var e=$("#textarea_sticker_numbers").val(),t=e.split(/[\s,\-]+|\(\d+\)/),s=[];return $.each(t,function(e,t){var n=i(t);void 0!=n&&s.push(n.number)}),s}function s(e,t,s,n){var i=e.join(","),r="dupes"==t?"duplicate":"missing";$.ajax({url:"/collections/add_stickers?stickers="+i+"&user="+user_uid+"&type="+r,success:function(e){$("#modal_add_stickers").modal("hide"),s&&s(e,r)},error:function(e){n&&n(e,r)}})}function n(){var e=$("#stats_refresh_spinner");$("#div_stats_container").hide(),e.show(),$.ajax({url:"/collections/get_stats?user="+user_uid,complete:function(t){var s=t.responseJSON.stats;$("#total_stickers_collected").text(s.collected),$.each(s.teams,function(e,t){var s=$("#li_stats_"+e).find(".stat_value");s.empty(),s.replaceWith(0==t?$('<span class="stat_value" style="color:green;"><strong>Completo!</strong></span>'):1==t?$('<span class="stat_value">S\xf3 falta <strong>1</strong> figurinha!!</span>'):$('<span class="stat_value">Faltam <strong>'+t+"</strong> figurinhas</span>"))}),e.hide(),$("#div_stats_container").show()}})}function i(e){return e=e.toUpperCase(),l[e]}function r(e,t){var s=$("duplicate"==t?"#div_dupes_stickers_container":"#div_missing_stickers_container"),i=s.parent().find(".sticker_refresh_spinner");s.hide(),s.find(".sticker_placeholder").remove(),i.show(),$.ajax({url:"/collections/get_stickers?user="+user_uid+"&type="+t,complete:function(e){$.each(e.responseJSON.stickers,function(e,n){var i=n.sticker,r=$("#sticker_placeholder_template").clone(!0);r.removeAttr("id"),r.find(".sticker_image").attr("src",images_prefix+i.image),"duplicate"==t&&n.qty>1?r.find(".sticker_dupe_count").text(n.qty):r.find(".sticker_dupe_count").remove(),r.find(".sticker_number").text(i.number),r.data("number",i.number),r.find(".btn_delete_sticker").data("number",i.number),r.find(".btn_delete_sticker").data("type","duplicate"==t?"dupes":"missing"),r.addClass("sticker_placeholder"),r.hover(o,u),r.show(),s.append(r)});var r=$("duplicate"==t?"#dupes_count":"#missing_count");r.text(e.responseJSON.total),i.hide(),s.show(),n()}})}function a(){alert("miss")}function c(e,t,s,n){var i=e.join(","),r="dupes"==t?"duplicate":"missing";$.ajax({url:"/collections/del_stickers?stickers="+i+"&user="+user_uid+"&type="+r,success:function(e){s&&s(e,r)},error:function(e){n&&n(e,r)}})}function o(e){$(e.currentTarget).find(".btn_delete_sticker").show()}function u(e){$(e.currentTarget).find(".btn_delete_sticker").hide()}var d=$("#hdn").attr("value"),l=JSON.parse(d);$("#btn_add_stickers").click(function(){e()}),$("#btn_add_dupes").click(function(){var e=t();e.length>0&&s(e,"dupes",r,a)}),$("#btn_add_missing").click(function(){var e=t();e.length>0&&s(e,"missing",r,a)}),$(".btn_delete_sticker").click(function(){var e=[],t=$(this).data("number"),s=$(this).data("type");e.push(t),c(e,s,r,a)}),$(".sticker_placeholder, .sticker_placeholder_template").hover(o,u)});